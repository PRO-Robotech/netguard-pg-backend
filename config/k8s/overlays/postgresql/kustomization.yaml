apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: netguard-postgresql
  annotations:
    config.kubernetes.io/local-config: "true"

# Base configuration
bases:
- ../../base

# PostgreSQL-specific resources
resources:
- postgres-secret.yaml    # Database credentials
- postgresql.yaml         # PostgreSQL StatefulSet + Service  
- backend-postgres.yaml   # 🐘 Backend with --pg-uri flag
- migration-job.yaml      # 🐘 sgroups-style migration job

# Override images for backend
images:
- name: netguard/pg-backend
  newTag: latest

# PostgreSQL-specific annotations
commonAnnotations:
  netguard.sgroups.io/backend-mode: "postgresql"
  netguard.sgroups.io/deployment-type: "production"
  netguard.sgroups.io/database-engine: "postgresql-15"
  
# Labels to identify this as postgresql deployment
commonLabels:
  netguard.sgroups.io/variant: "postgresql"