# Netguard Platform Automation Scripts

–ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Netguard –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –≤ Kubernetes.

## üìã –û–±–∑–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|------------|---------------|
| `analyze-current-state.sh` | –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è | `./analyze-current-state.sh` |
| `fix-namespaces.sh` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ namespace'–æ–≤ | `./fix-namespaces.sh` |
| `deploy-complete.sh` | –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ | `./deploy-complete.sh` |
| `test-complete.sh` | –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | `./test-complete.sh` |
| `compare-implementations.sh` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ CRD vs Aggregation | `./compare-implementations.sh` |
| `clean-redeploy.sh` | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ | `./clean-redeploy.sh` |
| `cleanup-old-deployment.sh` | –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | `./cleanup-old-deployment.sh` |
| `generate-certs.sh` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ | `./generate-certs.sh` |
| `dev-k8s.sh` | –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã | `./dev-k8s.sh [command]` |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
cd netguard-pg-backend/scripts
./analyze-current-state.sh
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
```bash
./fix-namespaces.sh
```

### 3. –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
./deploy-complete.sh
```

### 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å –æ–±–µ)
```bash
./compare-implementations.sh
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./test-complete.sh
```

## üîÑ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å namespace'–∞–º–∏)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—Ç–∞—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ `default` namespace:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
./clean-redeploy.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. üßπ –û—á–∏—Å—Ç–∏—Ç —Å—Ç–∞—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–∑ default namespace
2. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç namespace'—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 
3. üîê –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
4. üöÄ –†–∞–∑–≤–µ—Ä–Ω–µ—Ç –≤ netguard-system namespace
5. üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç v1beta1 (Aggregation Layer)

## üìñ –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

### `analyze-current-state.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è Netguard –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–µ.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ minikube
- üìÅ –ê–Ω–∞–ª–∏–∑ namespace'–æ–≤ –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ deployments –∏ –ø–æ–¥–æ–≤
- üîå –ê–Ω–∞–ª–∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ CRD
- üîç –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- üìà –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- üí° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
./analyze-current-state.sh                # –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
./analyze-current-state.sh namespaces     # –¢–æ–ª—å–∫–æ namespace'—ã
./analyze-current-state.sh workloads      # –¢–æ–ª—å–∫–æ –ø–æ–¥—ã –∏ deployments
./analyze-current-state.sh api            # –¢–æ–ª—å–∫–æ API —Ä–µ—Å—É—Ä—Å—ã
./analyze-current-state.sh recommendations # –¢–æ–ª—å–∫–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```

### `fix-namespaces.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π namespace'–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç:**
- ‚úÖ –ó–∞–º–µ–Ω—è–µ—Ç `namespace: default` –Ω–∞ `namespace: netguard-system`
- üîß –û–±–Ω–æ–≤–ª—è–µ—Ç BACKEND_ENDPOINT —Å –ø–æ–ª–Ω—ã–º FQDN
- üóëÔ∏è –£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- üìã –û–±–Ω–æ–≤–ª—è–µ—Ç kustomization.yaml
- üíæ –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

**–ü—Ä–∏–º–µ—Ä:**
```bash
./fix-namespaces.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ configmap.yaml - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (1 namespace'–æ–≤ netguard-system)
# ‚úÖ backend-deployment.yaml - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (2 namespace'–æ–≤ netguard-system)
# ‚úÖ deployment.yaml - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (1 namespace'–æ–≤ netguard-system)
# üéâ –í—Å–µ namespace'—ã —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!
```

### `deploy-complete.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Netguard –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ Kubernetes.

**–≠—Ç–∞–ø—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
1. üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
2. üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
3. üìÅ –°–æ–∑–¥–∞–Ω–∏–µ namespace —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
4. üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Kubernetes –∫–æ–¥–∞
5. üèóÔ∏è –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
6. üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –≤ minikube (–µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω)
7. üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes
8. ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
9. üß™ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
./deploy-complete.sh         # –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./deploy-complete.sh cleanup # –¢–æ–ª—å–∫–æ –æ—á–∏—Å—Ç–∫–∞
./deploy-complete.sh status  # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ minikube
- üìä –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚ö° –ü—Ä–æ–≤–µ—Ä–∫–∞ APIService –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- üîÑ –¢–∞–π–º–∞—É—Ç—ã –∏ retry –ª–æ–≥–∏–∫–∞

### `test-complete.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ Netguard –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

**–¢–µ—Å—Ç—ã:**
1. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
   - ‚úÖ Namespace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤—ã
   - üü¢ –ü–æ–¥—ã –∑–∞–ø—É—â–µ–Ω—ã
   - üîå –°–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã

2. **API —Ç–µ—Å—Ç—ã:**
   - üîó APIService –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
   - üéØ API —Ä–µ—Å—É—Ä—Å—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è
   - üìù CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

3. **–¢–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
   - üîÑ Backend –¥–æ—Å—Ç—É–ø–µ–Ω
   - ‚ù§Ô∏è Health endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

4. **–¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞:**
   - üìä –õ–æ–≥–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
./test-complete.sh              # –í—Å–µ —Ç–µ—Å—Ç—ã
./test-complete.sh quick        # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./test-complete.sh performance  # –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
./test-complete.sh status       # –î–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
./test-complete.sh logs         # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Netguard Platform
=============================================

üß™ –¢–µ—Å—Ç: Namespace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚úÖ PASSED: Namespace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

üß™ –¢–µ—Å—Ç: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
  –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞: test-crud-service-1699123456
  –ß—Ç–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
  –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
  ‚úì –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
‚úÖ PASSED: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
==========================
–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤: 10
–ü—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ: 10
–ü—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å: 0
üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!
```

### `compare-implementations.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ CRD (v1alpha1) –∏ Aggregation Layer (v1beta1) —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

**–í–∞–∂–Ω–æ:** Netguard –∏–º–µ–µ—Ç –¥–≤–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **v1alpha1** - —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ CustomResourceDefinitions (CRD)
- **v1beta1** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Kubernetes Aggregation Layer

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±–µ–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ API —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –≤–µ—Ä—Å–∏—è–º
- üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏
- ‚ö° –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üì¶ –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
./compare-implementations.sh                # –ü–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
./compare-implementations.sh check          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
./compare-implementations.sh crud           # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD
./compare-implementations.sh performance    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
./compare-implementations.sh recommendations # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π Netguard
================================
v1alpha1 (CRD) vs v1beta1 (Aggregation Layer)

üî∏ Aggregation Layer (v1beta1):
‚úÖ APIService v1beta1.netguard.sgroups.io –¥–æ—Å—Ç—É–ø–µ–Ω

üî∏ CRD —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (v1alpha1):
‚úÖ –ù–∞–π–¥–µ–Ω–æ 8 netguard CRD

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–µ—Ä—Å–∏—è–º:
  - v1alpha1 (CRD): 8 —Ä–µ—Å—É—Ä—Å–æ–≤
  - v1beta1 (Aggregation): 8 —Ä–µ—Å—É—Ä—Å–æ–≤

üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚ö† –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –û–ë–ï —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
1. üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
2. üéØ –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Aggregation Layer —Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ v1beta1
```

### `dev-k8s.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç).

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
./dev-k8s.sh dev       # –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
./dev-k8s.sh test      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
./dev-k8s.sh logs      # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./dev-k8s.sh forward   # Port forwarding
```

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ workflow'—ã

### –ü–µ—Ä–≤–∏—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# 1. –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
./analyze-current-state.sh

# 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
./fix-namespaces.sh

# 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./deploy-complete.sh

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
./test-complete.sh
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
```bash
# 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
./analyze-current-state.sh

# 2. –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./deploy-complete.sh cleanup
./deploy-complete.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
./test-complete.sh quick
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º
```bash
# 1. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
./analyze-current-state.sh config

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./test-complete.sh logs

# 3. –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
./deploy-complete.sh status

# 4. –†—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
kubectl get all -n netguard-system
kubectl describe apiservice v1beta1.netguard.sgroups.io
```

### –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–∏–π —Ü–∏–∫–ª
```bash
# 1. –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./test-complete.sh quick

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./dev-k8s.sh logs

# 3. Port forwarding –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
./dev-k8s.sh forward
```

## üõ°Ô∏è Best Practices

### Namespace'—ã
- ‚úÖ –í—Å–µ netguard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `netguard-system`
- ‚ùå –ò–∑–±–µ–≥–∞–π—Ç–µ `default` namespace
- üè∑Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- üîí Pod Security Standards: `restricted`
- üõ°Ô∏è Security contexts –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- üîê TLS –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- üìä Health –∏ readiness probes
- üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîç Tracing —á–µ—Ä–µ–∑ OpenTelemetry

### –†–µ—Å—É—Ä—Å—ã
- ‚ö° Resource requests –∏ limits
- üìà Horizontal Pod Autoscaler –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- üíæ Persistent volumes –¥–ª—è stateful –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## ‚ùó –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### APIService –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
kubectl describe apiservice v1beta1.netguard.sgroups.io

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥—ã
kubectl get pods -n netguard-system

# –õ–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞
kubectl logs -n netguard-system deployment/netguard-apiserver
```

### Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å connectivity
./test-complete.sh quick

# –õ–æ–≥–∏ backend
kubectl logs -n netguard-system deployment/netguard-backend

# Port forwarding –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
kubectl port-forward -n netguard-system service/netguard-backend 8080:8080
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–∑–∞–º–∏
```bash
# –î–ª—è minikube - –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑—ã –∑–∞–Ω–æ–≤–æ
minikube image load netguard/k8s-apiserver:latest
minikube image load netguard/pg-backend:latest

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make docker-build-k8s-apiserver
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `../config/k8s/README.md`
- **Makefile targets:** `../Makefile`
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `../swagger-ui/`
- **–ü—Ä–∏–º–µ—Ä—ã —Ä–µ—Å—É—Ä—Å–æ–≤:** `../test/k8s/`

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑: `./analyze-current-state.sh`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: `./analyze-current-state.sh recommendations`
3. –°–æ–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   ```bash
   kubectl get all -A | grep netguard > debug-info.txt
   kubectl describe apiservice v1beta1.netguard.sgroups.io >> debug-info.txt
   ./test-complete.sh logs >> debug-info.txt
   ``` 