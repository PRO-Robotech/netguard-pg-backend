# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kubernetes Aggregation Layer

## –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ `no kind "ServiceList" is registered for version "netguard.sgroups.io/v1beta1" in scheme` –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ aggregation layer.

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `SimpleAPIServer` –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ `genericapiserver.GenericAPIServer`
2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å main.go**: –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apiserver.NewOptions()`
3. **–°—Ö–µ–º–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞**: —Ç–∏–ø—ã –Ω–µ –±—ã–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–µ
4. **Watch –Ω–µ —Ä–∞–±–æ—Ç–∞–ª**: polling –º–µ—Ö–∞–Ω–∏–∑–º –Ω–µ –±—ã–ª –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Kubernetes API machinery

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–∏–ª–∏ main.go

```go
// –ë—ã–ª–æ:
options := apiserver.NewOptions(os.Stdout, os.Stderr)

// –°—Ç–∞–ª–æ:
options := apiserver.NewWardleServerOptions(os.Stdout, os.Stderr)
```

### 2. –ü–µ—Ä–µ–ø–∏—Å–∞–ª–∏ options.go

- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `WardleServerOptions`
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ `BackendClient` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ù–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ö–µ–º—É

### 3. –û–±–Ω–æ–≤–∏–ª–∏ server.go

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `clientscheme.Scheme` —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `genericapiserver.GenericAPIServer`
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes API machinery

### 4. –ò—Å–ø—Ä–∞–≤–∏–ª–∏ watch –º–µ—Ö–∞–Ω–∏–∑–º

- –î–æ–±–∞–≤–∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `NewPollerWatchInterface`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ —Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ Kubernetes

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä Kubernetes API –æ–ø–µ—Ä–∞—Ü–∏–π:**

### CRUD Operations
- **GET** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
- **LIST** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤  
- **CREATE** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
- **UPDATE** - –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
- **PATCH** - —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
- **DELETE** - —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

### Advanced Features
- **WATCH** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **OpenAPI** - –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- **Discovery API** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **kubectl –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å kubectl

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã

1. **services** - —Å–µ—Ç–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
2. **addressgroups** - –≥—Ä—É–ø–ø—ã –∞–¥—Ä–µ—Å–æ–≤
3. **addressgroupbindings** - –ø—Ä–∏–≤—è–∑–∫–∏ –≥—Ä—É–ø–ø –∞–¥—Ä–µ—Å–æ–≤
4. **addressgroupportmappings** - –º–∞–ø–ø–∏–Ω–≥–∏ –ø–æ—Ä—Ç–æ–≤
5. **rules2s** - –ø—Ä–∞–≤–∏–ª–∞ service-to-service
6. **servicealiases** - –∞–ª–∏–∞—Å—ã —Å–µ—Ä–≤–∏—Å–æ–≤
7. **addressgroupbindingpolicies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–≤—è–∑–æ–∫
8. **ieagagrules** - –ø—Ä–∞–≤–∏–ª–∞ ingress/egress

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
go build ./cmd/k8s-apiserver

# –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
./k8s-apiserver --backend-address=localhost:9090

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
chmod +x test-api.sh
./test-api.sh
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å kubectl

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞ –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ kubectl:

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
kubectl get services.netguard.sgroups.io

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
kubectl apply -f - <<EOF
apiVersion: netguard.sgroups.io/v1beta1
kind: Service
metadata:
  name: my-service
  namespace: default
spec:
  description: "My test service"
  ingressPorts:
  - protocol: TCP
    port: "80"
    description: "HTTP port"
EOF

# Watch –∏–∑–º–µ–Ω–µ–Ω–∏–π
kubectl get services.netguard.sgroups.io --watch

# –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞
kubectl describe service.netguard.sgroups.io/my-service
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Kubernetes** - –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤** - informers, listers, clientsets
3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã Kubernetes** - watch, events, conditions
4. **OpenAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤—Å–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Kubernetes API machinery

–¢–µ–ø–µ—Ä—å –≤–∞—à aggregation layer —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Kubernetes API —Å–µ—Ä–≤–µ—Ä! üéâ 